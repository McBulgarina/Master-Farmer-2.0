using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using System.Threading.Tasks;
using System.Threading;

namespace Master_FarmDrawer_2._0
{
    internal class Program
    {
        static bool GameOver = false;
        static int PlayerXpos = 30;
        static int PlayerYpos = 5;
        static int prevPlayerXpos;
        static int prevPlayerYpos;
        static double Money = 10;
        static int energy = 100;
        static int day = 0;
        static double EXP = 0;
        static int hours = 0;

        static int potatoes = 0;
        static int carrot = 0;
        static int wheat = 0;
        static int corn = 0;
        static int sunflower = 0;
        static int tomato = 0;
        static int pepper = 0;

        static int potatoesSeed = 1;
        static int carrotSeed = 0;
        static int wheatSeed = 0;
        static int cornSeed = 0;
        static int sunflowerSeed = 0;
        static int tomatoSeed = 0;
        static int pepperSeed = 0;

        static int potatoDropQuantity;
        static int carrotDropQuantity;
        static int wheatDropQuantity;
        static int cornDropQuantity;
        static int sunflowerDropQuantity;
        static int tomatoDropQuantity;
        static int pepperDropQuantity;

        static int PPrice;
        static int CPrice;
        static int WPrice;
        static int CoPrice;
        static int SPrice;
        static int TPrice;
        static int PePrice;

        static List<(int, int)> validPlantCoordinates = new List<(int, int)> { (4, 4), (8, 4), (12, 4), (16, 4), (20, 4), (4, 6), (8, 6), (12, 6), (16, 6), (20, 6) };

        static void Main(string[] args)
        {
            Console.SetWindowSize(200, 55);
            Console.SetBufferSize(200, 1000);
            while (!GameOver)
            {
                Console.CursorVisible = false;
                if (Math.Abs(PlayerXpos - 41) <= 3 && PlayerYpos == 7)
                {
                    Shop();
                }
                if (Console.KeyAvailable)
                {
                    var keyInfo = Console.ReadKey(true);
                    MovePlayer(keyInfo.Key);
                    PlantPos(keyInfo.Key, keyInfo.Modifiers);
                    Thread.Sleep(125);
                }
                Stats();
                FarmDraw();
                ShopDraw();
                PlayerDraw();
                UpdateTime();
            }
        }
        static void ShopDraw()
        {
            Console.SetCursorPosition(40, 2);
            Console.Write("██████");
            Console.SetCursorPosition(38, 3);
            Console.Write("██████████");
            Console.SetCursorPosition(37, 4);
            Console.Write("███$Shop$███");
            Console.SetCursorPosition(37, 5);
            Console.Write("████████████");
            Console.SetCursorPosition(37, 6);
            Console.Write("████    ████");
            Console.SetCursorPosition(36, 7);
            Console.Write("▄████    ████▄");
        }
        static void Shop()
        {
            Console.Clear();
            Stats();
            Crops();
            Console.WriteLine();
            Console.WriteLine("SHOP");
            Console.WriteLine("You are in the all mighty farmer's shop! Here you can buy items, seeds recipes or sell all your goods!");
            Console.WriteLine("What would you like to do?");
            Console.WriteLine("1. Sell crops");
            Console.WriteLine("2. Buy seeds");
            Console.WriteLine("3. Buy recipes");
            Console.WriteLine("4. Buy special items");
            Console.WriteLine("5. Exit");
            string inputShop = Console.ReadLine();
            switch (inputShop)
            {
                case "1":
                    SellInShop();
                    break;
                case "2":
                    BuyInShop();
                    break;
                case "3":
                    break;
                case "4":
                    break;
                case "5":
                    PlayerYpos = 8;
                    PlayerXpos = 42;
                    Console.Clear();
                    break;
            }
            hours += 2;
            ReduceEnergy();
        }
        static void BuyInShop()
        {
            Console.Clear();
            Console.WriteLine("Buy crops:");
            Console.WriteLine("1. potatoese: " + PPrice * 0.75 + "$");
            Console.WriteLine("2. Carrot: " + CPrice * 0.75 + "$");
            Console.WriteLine("3. Wheat: " + WPrice * 0.75 + "$");
            Console.WriteLine("4. Corn: " + CoPrice * 0.75 + "$");
            Console.WriteLine("5. Sunflower: " + SPrice * 0.75 + "$");
            Console.WriteLine("6. Tomato: " + TPrice * 0.75 + "$");
            Console.WriteLine("7. Pepper: " + PePrice * 0.75 + "$");
            Console.WriteLine("8. Exit");
            string input2 = Console.ReadLine();
            switch (input2)
            {
                case "1":
                    Console.WriteLine("How many potatoese seeds do you want to buy?");
                    int amount = int.Parse(Console.ReadLine());
                    if (Money >= PPrice * 0.75 * amount)
                    {
                        Money -= PPrice * 0.75 * amount;
                        potatoesSeed += amount;
                        Console.WriteLine("You bought " + amount + " potatoese seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "2":
                    Console.WriteLine("How many carrot seeds do you want to buy?");
                    int amount2 = int.Parse(Console.ReadLine());
                    if (Money >= CPrice * 0.75 * amount2)
                    {
                        Money -= CPrice * 0.75 * amount2;
                        carrotSeed += amount2;
                        Console.WriteLine("You bought " + amount2 + " carrot seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "3":
                    Console.WriteLine("How many wheat seeds do you want to buy?");
                    int amount3 = int.Parse(Console.ReadLine());
                    if (Money >= WPrice * 0.75 * amount3)
                    {
                        Money -= WPrice * 0.75 * amount3;
                        wheatSeed += amount3;
                        Console.WriteLine("You bought " + amount3 + " wheat seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "4":
                    Console.WriteLine("How many corn seeds do you want to buy?");
                    int amount4 = int.Parse(Console.ReadLine());
                    if (Money >= CoPrice * 0.75 * amount4)
                    {
                        Money -= CoPrice * 0.75 * amount4;
                        cornSeed += amount4;
                        Console.WriteLine("You bought " + amount4 + " corn seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "5":
                    Console.WriteLine("How many sunflower seeds do you want to buy?");
                    int amount5 = int.Parse(Console.ReadLine());
                    if (Money >= SPrice * 0.75 * amount5)
                    {
                        Money -= SPrice * 0.75 * amount5;
                        sunflowerSeed += amount5;
                        Console.WriteLine("You bought " + amount5 + " sunflower seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "6":
                    Console.WriteLine("How many tomatoe seeds do you want to buy?");
                    int amount6 = int.Parse(Console.ReadLine());
                    if (Money >= TPrice * 0.75 * amount6)
                    {
                        Money -= TPrice * 0.75 * amount6;
                        tomatoSeed += amount6;
                        Console.WriteLine("You bought " + amount6 + " tomatoe seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "7":
                    Console.WriteLine("How many pepper seeds do you want to buy?");
                    int amount7 = int.Parse(Console.ReadLine());
                    if (Money >= PePrice * 0.75 * amount7)
                    {
                        Money -= PePrice * 0.75 * amount7;
                        pepperSeed += amount7;
                        Console.WriteLine("You bought " + amount7 + " pepper seeds!");
                        Thread.Sleep(500);
                        Shop();
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough money!");
                    }
                    break;
                case "8":
                    Console.Clear();
                    break;
            }
        }
        static void SellInShop()
        {
            Console.WriteLine("Sell items:");
            Console.WriteLine("1. potatoes: " + PPrice + "$");
            Console.WriteLine("2. Carrot: " + CPrice + "$");
            Console.WriteLine("3. Wheat: " + WPrice + "$");
            Console.WriteLine("4. Corn: " + CoPrice + "$");
            Console.WriteLine("5. Sunflower: " + SPrice + "$");
            Console.WriteLine("6. Tomato: " + TPrice + "$");
            Console.WriteLine("7. Pepper: " + PePrice + "$");
            Console.WriteLine("8. Sell all your goods");
            Console.WriteLine("9. Exit");
            string input = Console.ReadLine();
            switch (input)
            {
                case "1":
                    if (potatoes >= 1)
                    {
                        Console.WriteLine("How many potatoeses do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (potatoes >= amount)
                        {
                            Money += PPrice * amount;
                            potatoes -= amount;
                            EXP += 1 * amount;
                            Console.WriteLine("You sold " + amount + " potatoeses!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough potatoeses!");
                        }
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough crops!");
                    }
                    break;
                case "2":
                    if (carrot >= 1)
                    {
                        Console.WriteLine("How many carrots do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (carrot >= amount)
                        {
                            Money += CPrice * amount;
                            carrot -= amount;
                            EXP += 1.5 * amount;
                            Console.WriteLine("You sold " + amount + " carrots!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough carrots!");
                        }
                    }
                    else
                    {
                        Console.WriteLine("You don't have enough crops!");
                    }
                    break;
                case "3":
                    if (wheat >= 1)
                    {
                        Console.WriteLine("How much wheat do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (wheat >= amount)
                        {
                            Money += WPrice * amount;
                            wheat -= amount;
                            EXP += 2 * amount;
                            Console.WriteLine("You sold " + amount + " wheat!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough wheat!");
                        }
                    }
                    break;
                case "4":
                    if (corn >= 1)
                    {
                        Console.WriteLine("How much corn do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (corn >= amount)
                        {
                            Money += CoPrice * amount;
                            corn -= amount;
                            EXP += 4 * amount;
                            Console.WriteLine("You sold " + amount + " corn!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough corn!");
                        }

                    }
                    break;
                case "5":
                    if (sunflower >= 1)
                    {
                        Console.WriteLine("Hom many sunflowers do you want to sell");
                        int amount = int.Parse(Console.ReadLine());
                        if (sunflower >= amount)
                        {
                            Money += SPrice * amount;
                            sunflower -= amount;
                            EXP += 4 * amount;
                            Console.WriteLine("You sold " + amount + " sunflowers!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough sunflowers!");
                        }
                    }
                    break;
                case "6":
                    if (tomato >= 1)
                    {
                        Console.WriteLine("How many tomatoes do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (tomato >= amount)
                        {
                            Money += TPrice * amount;
                            tomato -= amount;
                            EXP += 3 * amount;
                            Console.WriteLine("You sold " + amount + " tomatoes!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough tomatoes!");
                        }
                    }
                    break;
                case "7":
                    if (pepper >= 1)
                    {
                        Console.WriteLine("How many peppers do you want to sell?");
                        int amount = int.Parse(Console.ReadLine());
                        if (pepper >= amount)
                        {
                            Money += PePrice * amount;
                            pepper -= amount;
                            EXP += 2.5 * amount;
                            Console.WriteLine("You sold " + amount + " peppers!");
                            Thread.Sleep(500);
                            Shop();
                        }
                        else
                        {
                            Console.WriteLine("You don't have enough peppers!");
                        }
                    }
                    break;
                case "8":
                    Console.WriteLine("You sold all your goods!");
                    Money += PPrice * potatoes;
                    Money += CPrice * carrot;
                    Money += WPrice * wheat;
                    Money += CoPrice * corn;
                    Money += SPrice * sunflower;
                    Money += TPrice * tomato;
                    Money += PePrice * pepper;
                    potatoes = 0;
                    carrot = 0;
                    wheat = 0;
                    corn = 0;
                    sunflower = 0;
                    tomato = 0;
                    pepper = 0;
                    Thread.Sleep(500);
                    Shop();
                    break;
                case "9":
                    PlayerYpos = 8;
                    Console.Clear();
                    break;
            }
        }
        static void FarmDraw()
        {
            for (int y = 0; y < 5; y++)
            {
                Console.SetCursorPosition(3, 3 + y);
                for (int x = 0; x < 5; x++)
                {
                    Console.Write("▒▒▒");
                    Console.Write(' ');
                }
            }
        }
        static void Crops()
        {
            Random random = new Random();
            PPrice = random.Next(2, 3);
            CPrice = random.Next(1, 2);
            WPrice = random.Next(1, 3);
            CoPrice = random.Next(3, 5);
            SPrice = random.Next(5, 7);
            TPrice = random.Next(1, 2);
            PePrice = random.Next(2, 3);
        }
        static void CropDrops()
        {
            Random random = new Random();
            potatoDropQuantity = random.Next(2, 4);
            carrotDropQuantity = random.Next(1, 3);
            wheatDropQuantity = random.Next(1, 2);
            cornDropQuantity = random.Next(2, 4);
            sunflowerDropQuantity = random.Next(1, 2);
            tomatoDropQuantity = random.Next(3, 7);
            pepperDropQuantity = random.Next(5, 9);
        }
        static void PlantPos(ConsoleKey key, ConsoleModifiers modifiers)
        {
            if (validPlantCoordinates.Contains((PlayerXpos, PlayerYpos)))
            {
                Console.SetCursorPosition(2, 24);
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("Press: shift+ (wanted plant's first letter) to plant a seed!");
                Plant(key, modifiers);
                Console.ForegroundColor = ConsoleColor.White;
            }
        }
        static void Plant(ConsoleKey key, ConsoleModifiers modifiers)
        {
            CropDrops();
            if (modifiers.HasFlag(ConsoleModifiers.Shift))
            {
                switch (key)
                {
                    case ConsoleKey.P:
                        if (potatoesSeed > 0)
                        {
                            potatoesSeed--;
                            potatoes += potatoDropQuantity;
                            Console.WriteLine("Planted a potato!");
                            hours += 2;
                        }
                        else
                        {
                            Console.WriteLine("No potato seeds left!");
                        }
                        break;
                    case ConsoleKey.C:
                        if (carrotSeed > 0)
                        {
                            carrotSeed--;
                            carrot += carrotDropQuantity;
                            Console.WriteLine("Planted a carrot!");
                            hours += 1;
                        }
                        else
                        {
                            Console.WriteLine("No carrot seeds left!");
                        }
                        break;
                    case ConsoleKey.W:
                        if (wheatSeed > 0)
                        {
                            wheatSeed--;
                            wheat += wheatDropQuantity;
                            Console.WriteLine("Planted wheat!");
                            hours += 4;
                        }
                        else
                        {
                            Console.WriteLine("No wheat seeds left!");
                        }
                        break;
                    case ConsoleKey.O:
                        if (cornSeed > 0)
                        {
                            cornSeed--;
                            corn += cornDropQuantity;
                            Console.WriteLine("Planted corn!");
                            hours += 3;
                        }
                        else
                        {
                            Console.WriteLine("No corn seeds left!");
                        }
                        break;
                    case ConsoleKey.S:
                        if (sunflowerSeed > 0)
                        {
                            sunflowerSeed--;
                            sunflower += sunflowerDropQuantity;
                            Console.WriteLine("Planted a sunflower!");
                            hours += 7;
                        }
                        else
                        {
                            Console.WriteLine("No sunflower seeds left!");
                        }
                        break;
                    case ConsoleKey.T:
                        if (tomatoSeed > 0)
                        {
                            tomatoSeed--;
                            tomato += tomatoDropQuantity;
                            Console.WriteLine("Planted a tomato!");
                            hours += 5;
                        }
                        else
                        {
                            Console.WriteLine("No tomato seeds left!");
                        }
                        break;
                    case ConsoleKey.E:
                        if (pepperSeed > 0)
                        {
                            pepperSeed--;
                            pepper += pepperDropQuantity;
                            Console.WriteLine("Planted a pepper!");
                            hours += 4;
                        }
                        else
                        {
                            Console.WriteLine("No pepper seeds left!");
                        }
                        break;
                }
                ReduceEnergy();
            }
        }
        static void PlayerDraw()
        {
            Console.SetCursorPosition(prevPlayerXpos, prevPlayerYpos);
            Console.Write(" ");
            Console.SetCursorPosition(PlayerXpos, PlayerYpos);
            Console.Write("╬");
        }
        static void MovePlayer(ConsoleKey key)
        {
            prevPlayerXpos = PlayerXpos;
            prevPlayerYpos = PlayerYpos;

            switch (key)
            {
                case ConsoleKey.W:
                    if (PlayerYpos > 0) PlayerYpos--;
                    break;
                case ConsoleKey.S:
                    if (PlayerYpos < Console.WindowHeight - 1) PlayerYpos++;
                    break;
                case ConsoleKey.A:
                    if (PlayerXpos > 0) PlayerXpos--;
                    break;
                case ConsoleKey.D:
                    if (PlayerXpos < Console.WindowWidth - 1) PlayerXpos++;
                    break;
            }
        }
        static void Stats()
        {
            Console.SetCursorPosition(0, 0);
            Console.ForegroundColor = ConsoleColor.Green;
            Console.Write("Money: " + Money + '$');
            Console.SetCursorPosition(15, 0);
            Console.Write("Day: " + day);
            Console.SetCursorPosition(30, 0);
            Console.Write("Energy: " + energy);
            Console.SetCursorPosition(45, 0);
            Console.Write("EXP: " + EXP);
            Console.SetCursorPosition(60, 0);
            Console.Write("Hours: " + hours);
            Console.WriteLine();
            Console.ForegroundColor = ConsoleColor.DarkGreen;
            Console.Write("Potatoes: " + potatoes + "/" + potatoesSeed);
            Console.SetCursorPosition(15, 1);
            Console.Write("Carrots: " + carrot + "/" + carrotSeed);
            Console.SetCursorPosition(30, 1);
            Console.Write("Wheat: " + wheat + "/" + wheatSeed);
            Console.SetCursorPosition(45, 1);
            Console.Write("Corn: " + corn + "/" + cornSeed);
            Console.SetCursorPosition(60, 1);
            Console.Write("Sunflowers: " + sunflower + "/" + sunflowerSeed);
            Console.SetCursorPosition(75, 1);
            Console.Write("Tomatoes: " + tomato + "/" + tomatoSeed);
            Console.SetCursorPosition(90, 1);
            Console.Write("Peppers: " + pepper + "/" + pepperSeed);
            Console.ForegroundColor = ConsoleColor.White;
        }
        static void UpdateTime()
        {
            if (hours >= 24)
            {
                day++;
                hours -= 24;
            }
        }
        static void ReduceEnergy()
        {
            energy -= 3 * hours;
            if (energy < 0)
            {
                energy = 0;
                GameOver = true;
                Console.Clear();
                Console.WriteLine("Game Over! You have run out of energy.");
            }
        }
    }
}
